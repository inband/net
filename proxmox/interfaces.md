# interfaces

How does this work?
(this interfaces config is taken from the physical host)

```

enp3s0f0-------\
                 bond0 ------vmbr0---------(52: veth100i0@if51-----51: eth0@if52:)
enp3s0f0-------/                                    Host               Container
                                      

```

Take 2 physical interfaces

```
iface enp3s0f0 inet manual

iface enp3s0f1 inet manual

```

Bond pair in LACP mode

```
auto bond0
iface bond0 inet manual
	slaves enp3s0f0 enp3s0f1
	bond_miimon 100
	bond_mode 802.3ad
	bond_xmit_hash_policy layer2+3
```

Create bridge from this host to vHosts

```
auto vmbr0
iface vmbr0 inet static
	address  172.16.0.99
	netmask  255.255.255.0
	gateway  172.16.0.1
	bridge_ports bond0
	bridge_stp off
	bridge_fd 0
```

Representation on host
Then `ip addr` on physcial host
```
52: veth100i0@if51: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master vmbr0 state UP group default qlen 1000
    link/ether fe:69:76:00:00:00 brd ff:ff:ff:ff:ff:ff link-netnsid 0
```


Representation on container
```
pct enter 100
ip addr
51: eth0@if52: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether ca:52:3e:0a:50:f0 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 172.16.0.100/24 brd 172.16.0.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::c852:3eff:fe0a:50f0/64 scope link 
       valid_lft forever preferred_lft forever

```





```
root@pve5-lab:~# cat /etc/network/interfaces
# network interface settings; autogenerated
# Please do NOT modify this file directly, unless you know what
# you're doing.
#
# If you want to manage part of the network configuration manually,
# please utilize the 'source' or 'source-directory' directives to do
# so.
# PVE will preserve these directives, but will NOT its network
# configuration from sourced files, so do not attempt to move any of
# the PVE managed interfaces into external files!

auto lo
iface lo inet loopback

iface enp3s0f0 inet manual

iface enp3s0f1 inet manual

iface enp4s0f0 inet manual

iface enp4s0f1 inet manual

iface ens2f0 inet manual

iface ens2f1 inet manual

auto bond0
iface bond0 inet manual
	slaves enp3s0f0 enp3s0f1
	bond_miimon 100
	bond_mode 802.3ad
	bond_xmit_hash_policy layer2+3

auto bond1
iface bond1 inet manual
	slaves enp4s0f0 enp4s0f1
	bond_miimon 100
	bond_mode 802.3ad
	bond_xmit_hash_policy layer2+3

auto bond2
iface bond2 inet manual
	slaves ens2f0 ens2f1
	bond_miimon 100
	bond_mode 802.3ad
	bond_xmit_hash_policy layer2+3

auto vmbr0
iface vmbr0 inet static
	address  172.16.0.99
	netmask  255.255.255.0
	gateway  172.16.0.1
	bridge_ports bond0
	bridge_stp off
	bridge_fd 0

auto vmbr1
iface vmbr1 inet static
	address  172.16.1.99
	netmask  255.255.255.0
	bridge_ports bond1
	bridge_stp off
	bridge_fd 0

auto vmbr2
iface vmbr2 inet static
	address  172.16.2.99
	netmask  255.255.255.0
	bridge_ports bond2
	bridge_stp off
	bridge_fd 0
```
